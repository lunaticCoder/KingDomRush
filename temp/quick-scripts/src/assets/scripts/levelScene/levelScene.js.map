{"version":3,"sources":["assets/scripts/levelScene/levelScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameDataStorage, { GameConfig, User } from \"../common/module/gameDataManager\";\nimport MonsterFactory from \"./monster/monsterFactory\";\nimport V_gameState from \"./V_gameState\";\nimport SettlementFace from \"./settlementFace\";\nimport Utils from \"../common/module/utils\";\nimport Monster from \"./monster/monster\";\nimport Builder from \"./builder\";\nimport LevelDataManager, { Level } from \"../common/module/levelDataManager\";\nimport LoadingDoorAnim from \"../../res/prefabs/loadingDoorAnim/loadingDoorAnim\";\nimport SoundsManager from \"../common/module/soundsManager\";\nimport Soldier from \"./tower/barrack/soldier\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class LevelScene extends cc.Component {\n\n    @property({ type: LoadingDoorAnim })\n    private loadingDoorAnim: LoadingDoorAnim = null;\n\n    @property({ type: cc.Node })\n    private pauseFace: cc.Node = null;\n\n    @property({ type: cc.Node })\n    private setFace: cc.Node = null;\n\n    @property({ type: MonsterFactory })\n    private monsterFactory: MonsterFactory = null;\n\n    @property({ type: cc.Prefab })\n    private builderPrefab: cc.Prefab = null;\n\n    @property({ type: V_gameState })\n    private V_gameState: V_gameState = null;\n\n    @property({})\n    private isDebug: boolean = false;\n\n    @property({\n        type: cc.Sprite,\n        displayName: \"地图\"\n    })\n    private spriteOfMap: cc.Sprite = null;\n\n    /* 关卡信息 */\n    levelNum: number;\n    /**\n     * 在进行第几波\n     */\n    private roundIndex;\n    /**\n     * 最大回合数\n     */\n    private maxRound: number;\n    /**\n     * 关卡信息\n     */\n    levelData: Level;\n\n    /* 玩家信息 */\n    private maxHP: number;\n    private HP: number;\n    /**\n     * 金币数\n     */\n    cash: number;\n    /**\n     * 游戏得分\n     */\n    private gameReview: number;\n    private user: User = null;\n\n    /* 控制 */\n    private isBackButton: boolean = false;\n    private isExitButton: boolean = false;\n    private startGame: boolean = false;\n    /**\n     * 计时，用于控制游戏回合阶段\n     */\n    private cT: number = 0;\n\n    /* 数据 */\n    /**\n     * 存在的怪物数组\n     */\n    private monsterArray: Monster[] = null;\n\n    private gameConfig: GameConfig = null;\n    private animOfVPMap: cc.Animation = null;\n    /**\n     * 放置空地的根节点\n     */\n    private builderMap: cc.Node = null;\n    private settlementFace: SettlementFace = null;\n\n    onLoad() {\n        this.settlementFace = cc.find(\"Canvas/centerUI/settlementFace\").getComponent(\"settlementFace\");\n        this.gameConfig = GameDataStorage.getGameConfig();\n        this.animOfVPMap = cc.find(\"Canvas/VPMap\").getComponent(cc.Animation);\n        this.builderMap = cc.find(\"Canvas/builderMap\");\n        this.monsterArray = Monster.monstersOfAlive;\n        this.user = GameDataStorage.getCurrentUser();\n\n        Soldier.soldiersOfAlive = [];\n        console.log(\"士兵数组\", Soldier.soldiersOfAlive);\n    }\n\n    start() {\n        this.buildScene();\n\n        console.log(`#进入关卡${this.levelNum}`);\n        SoundsManager.ins.curBGM = \"sounds/gameBGM/game_bg\" + Utils.getRandomInterger(1, 5);\n        SoundsManager.ins.playBGM(SoundsManager.ins.curBGM);\n\n        //打开碰撞检测系统\n        let manager: cc.CollisionManager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        if (this.isDebug) {\n            manager.enabledDebugDraw = true;\n            manager.enabledDrawBoundingBox = true;\n        }\n    }\n\n    private buildScene() {\n        cc.loader.loadRes(\"levelData/level\" + this.levelNum + \"/roadData\", cc.AnimationClip, function (e, res: any) {\n            //添加移动路径的动画\n            this.animOfVPMap.addClip(res);\n            this.levelData = LevelDataManager.getLevelData(this.levelNum);\n\n            //添加空地（用于建塔）\n            let posArr: cc.Vec2[] = this.levelData.posOfBuilders;\n            for (let i = 0; i < posArr.length; i++) {\n                let n: cc.Node = cc.instantiate(this.builderPrefab);\n                let b: Builder = n.getComponent(\"builder\");\n                this.builderMap.addChild(n);\n                n.setPosition(posArr[i]);\n                b.init(i);\n            }\n\n            cc.loader.loadRes(\"levelData/level\" + this.levelNum + \"/map\" + this.levelNum, cc.SpriteFrame, function (e, res: any) {\n                //设置地图\n                this.spriteOfMap.spriteFrame = res;\n\n                this.init();\n                this.loadingDoorAnim.openDoor();\n                this.startGame = true;\n            }.bind(this))\n        }.bind(this));\n    }\n\n    /**\n     * 初始化玩家状态，回合数\n     */\n    private init() {\n        //设置玩家和回合信息\n        this.HP = this.maxHP = this.gameConfig.getInitBlood();\n        this.cash = this.gameConfig.getInitChip();\n        this.maxRound = this.levelData.noOfRound.length;\n        this.gameReview = 0;\n\n        //更新界面显示\n        this.V_gameState.setHP(this.HP);\n        this.V_gameState.setGold(this.cash);\n        this.V_gameState.setRound(1, this.maxRound);\n\n        //初始化回合控制\n        this.roundIndex = 1;\n        this.cT = 0;\n\n        //初始化monsterFactory\n        this.monsterFactory.init(this.levelData.roadNum);\n    }\n\n\n    subHP() {\n        this.HP--;\n        this.V_gameState.setHP(this.HP);\n        if (this.HP <= 0) {\n            this.startGame = false;\n            this.settlementFace.outFailFace();\n        }\n    }\n\n    /**\n     * Subs cash\n     * @param n 减的数量\n     * @returns 不够返回false \n     */\n    subCash(n: number): boolean {\n        if (this.cash < n)\n            return false;\n        this.cash -= n;\n        this.V_gameState.setGold(this.cash);\n        return true;\n    }\n\n    addCash(n: number) {\n        this.cash += n;\n        this.V_gameState.setGold(this.cash);\n    }\n\n\n    /* 按钮绑定 */\n    backButton() {\n        if (this.isBackButton) //保证播放开门动画期间，按按钮 不重复开门\n            return;\n        this.isBackButton = true;\n\n        SoundsManager.ins.playEffect(\"sounds/click\");\n        let func: cc.ActionInstant = cc.callFunc(function () {\n            cc.director.loadScene(\"selectLevelScene\", function () {\n                let loadingDoorAnim: cc.Node = cc.find(\"Canvas/loadingDoorAnim\");\n                let loadingDoorAnimScr: LoadingDoorAnim = loadingDoorAnim.getComponent(\"loadingDoorAnim\");\n                loadingDoorAnimScr.setState(false);\n\n                loadingDoorAnimScr.openDoor();\n            });\n        }, this);\n        this.loadingDoorAnim.closeDoor(func);\n\n        GameDataStorage.preserveGameData();\n    }\n\n    pauseButton() {\n        this.pauseFace.active = true;\n        this.pauseFace.runAction(cc.fadeIn(0.2));\n        this.scheduleOnce(function () {\n            cc.director.pause();\n        }, 0.2)\n    }\n\n    /**\n     * 游戏暂停后继续\n     */\n    resumeButton() {\n        cc.director.resume();\n        this.pauseFace.runAction(cc.fadeOut(0.2))\n        this.scheduleOnce(function () {\n            this.pauseFace.active = false;\n        }.bind(this), 0.2);\n    }\n\n    setButton() {\n        this.setFace.active = true;\n        this.setFace.runAction(cc.fadeIn(0.2));\n        this.scheduleOnce(function () {\n            cc.director.pause();\n        }, 0.2)\n    }\n\n    closeButton() {\n        cc.director.resume();\n        this.setFace.runAction(cc.fadeOut(0.2))\n        this.scheduleOnce(function () {\n            this.setFace.active = false;\n        }.bind(this), 0.2);\n    }\n\n    resetButton() {\n        cc.director.resume();\n\n        //判断是在哪个面板点击的按钮，隐藏该面板\n        if (this.setFace.active) {\n            this.setFace.runAction(cc.fadeOut(0.2));\n            this.scheduleOnce(function () {\n                this.setFace.active = false;\n            }, 0.2)\n        }\n        else\n            this.settlementFace.hiddenSettleFace();\n\n        //重置游戏\n        this.monsterFactory.clearMonsters();\n        this.monsterFactory.init(this.levelData.roadNum);\n\n        this.resetLand();\n        this.init();\n\n        this.startGame = true;\n    }\n\n    /**\n     * 离开游戏\n     * @returns  \n     */\n    exitButton() {\n        cc.director.resume();\n        this.settlementFace.hiddenSettleFace();\n\n        if (this.isExitButton) //保证播放开门动画期间，按开始游戏按钮 不重复开门\n            return;\n        this.isExitButton = true;\n\n        SoundsManager.ins.playEffect(\"sounds/click\");\n        let func: cc.ActionInstant = cc.callFunc(function () {\n            cc.director.loadScene(\"selectLevelScene\");\n        }, this);\n        this.loadingDoorAnim.closeDoor(func);\n\n        GameDataStorage.preserveGameData();\n    }\n\n    /**\n     * 重置空地,删除建在上面的塔\n     */\n    private resetLand() {\n        let childre: cc.Node[] = this.builderMap.children;\n        childre.forEach(e => {\n            let builder: Builder = e.getComponent(\"builder\");\n            builder.deleteTower();\n            builder.hiddenBuildFaceImmediately();\n        });\n    }\n\n    /**\n     * 刷新回合，生成怪物\n     */\n    private refreshRound(dt: number) {\n        //回合计时控制\n        if (this.roundIndex <= this.maxRound) {\n            this.cT += dt;\n            if (this.cT >= this.levelData.timeOfRound[this.roundIndex - 1]) { //开始进行这一波\n                //更新显示的回合数\n                this.V_gameState.setRound(this.roundIndex, this.maxRound);\n\n                //生成这一波   \n                let no: number[][] = this.levelData.noOfRound;\n                let mNums: number[] = no[this.roundIndex - 1];\n                for (let i = 0; i < mNums.length; i++) {\n                    this.monsterFactory.createMonster(no[this.roundIndex - 1][i]);\n                }\n\n                this.cT = 0;\n                this.roundIndex++;\n            }\n        }\n        else if (Monster.monstersOfAlive.length === 0 && this.monsterFactory.creMonList.length === 0 && this.HP > 0) { //所有波怪物全部出发，怪物全部被消灭或离开，并且生命不为0。游戏胜利\n            if (this.HP === this.maxHP)\n                this.gameReview = 3;\n            else if (this.HP >= this.maxHP / 2)\n                this.gameReview = 2;\n            else\n                this.gameReview = 1;\n            this.settlementFace.outPassFace(this.gameReview);\n            this.startGame = false;\n            this.user.setLevelReview(this.levelNum - 1, this.gameReview);\n        }\n    }\n\n    update(dt) {\n        if (!this.startGame)\n            return;\n\n        this.refreshRound(dt);\n    }\n}\n\n"]}