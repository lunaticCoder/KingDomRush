{"version":3,"sources":["assets/scripts/levelScene/creature.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import FrameAnimation from \"../common/frameAnimation\";\nimport CombatLogic from \"./combatLogic\";\nimport Move from \"../common/move\";\nimport Utils from \"../common/module/utils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default abstract class Creature extends cc.Component {\n\n    /* 属性 */\n    protected cHP: number = null;\n    protected maxHp: number = null;\n    protected speedOfMove: number = null;\n    protected intervalOfAttack: number = null;\n    protected aggressivity: number = null;\n    rangeOfAttack: number = null;\n    rangeOfInvestigate: number = null;\n    protected intervalOfThink: number = 1;\n\n    /* 引用对象 */\n    @property({ type: cc.ProgressBar })\n    protected bloodBar: cc.ProgressBar = null;\n\n    @property({ type: FrameAnimation })\n    protected frameAnim: FrameAnimation = null;\n\n    protected combatLogic: CombatLogic = null;\n    protected _move: Move = null;\n\n\n    /* 控制 */\n    protected isAlive: boolean = false;\n    isTracking: boolean = false;\n    isAttacking: boolean = false;\n    isNonComState: boolean = false;\n\n    protected initCreature() {\n        this.isTracking = false;\n        this.isAttacking = false;\n        //刚出生，还没执行非战斗行为\n        this.isNonComState = null;\n        this.isAlive = true;\n    }\n\n    protected abstract walk(des: cc.Vec2, func: Function);\n    protected abstract stopWalk();\n    /**\n     * 只进行移动,移除其他Action\n     * @param des 世界\n     * @returns 方向\n     */\n    protected move(des: cc.Vec2, func: Function = null, t: number = null) {\n        let dnp: cc.Vec2 = this.node.parent.convertToNodeSpaceAR(des);\n        let cnp: cc.Vec2 = this.node.getPosition();\n        let dis: cc.Vec2 = dnp.sub(cnp);\n        if (t === null) {\n            let l: number = dis.mag();\n            t = l / this.speedOfMove;\n        }\n\n\n        this._move.moveTo(dis, t, func);\n    }\n\n\n    /**\n     * 播放死亡动画,会移除当前的所有行为\n     */\n    protected playDie(frames: cc.SpriteFrame[], func: Function = null) {\n        if (this.isNonComState)\n            this.stopNonComLogic();\n        else if (this.isAttacking)\n            this.frameAnim.stop();\n        else if (this.isTracking)\n            this.stopTrack();\n\n        this.frameAnim.setFrameArray(frames);\n        this.frameAnim.play(false, false, false, function () {\n            let fOut: cc.ActionInterval = cc.fadeOut(1);\n            let f: cc.ActionInstant = cc.callFunc(func);\n            this.node.runAction(cc.sequence(fOut, f));\n        }.bind(this));\n    }\n\n    /**\n     * 设置该生物死亡并从存活记录集中移除\n     * @param creatures 该生物存在的集\n     */\n    die(creatures: any[], self) {\n        this.isAlive = false;\n        Utils.remvoeItemOfArray(creatures, self);\n    }\n\n    /**\n     * @param des 目的地 世界 \n     */\n    protected updateDir(des: cc.Vec2) {\n        let cwp: cc.Vec2 = this.getWPos();\n        if (des.x > cwp.x)\n            this.node.scaleX = 1;\n        else\n            this.node.scaleX = -1;\n    }\n\n    /**\n     * 得到其世界坐标\n     */\n    public getWPos(): cc.Vec2 {\n        return this.node.parent.convertToWorldSpaceAR(this.node.getPosition());\n    }\n\n    /**\n     * 受到伤害\n     */\n    injure(v: number) {\n        if (this.cHP === 0)\n            return;\n\n        this.cHP -= v;\n        if (this.cHP < 0)\n            this.cHP = 0;\n    }\n\n    /**\n     * 更新血条显示\n     */\n    protected refreshBloodBar() {\n        let r: number = this.cHP / this.maxHp;\n        this.bloodBar.progress = r;\n    }\n\n    protected abstract refreshState();\n\n    abstract releaseSelf();\n\n    /**\n     * Tracks creature\n     * @param pos  世界\n     */\n    abstract track(pos: cc.Vec2);\n    abstract stopTrack();\n    abstract refreshTrackTarget(pos: cc.Vec2);\n    abstract attack(m: Creature);\n    abstract nonComLogic();\n    abstract stopNonComLogic();\n\n    update(dt) {\n        if (!this.isAlive)\n            return;\n\n        this.combatLogic.think();\n        this._move.refreshMove(dt);\n        this.refreshState();\n    }\n}\n"]}