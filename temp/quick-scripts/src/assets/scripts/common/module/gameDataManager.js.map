{"version":3,"sources":["assets/scripts/common/module/gameDataManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Utils from \"./utils\";\nimport StorageManager from \"./storageManager\";\n\nexport class User {\n    /**\n     * 初始用户数据\n     */\n    private initUserData = {\n        username: \"无\",\n        levelsReview: [], //每关得的星星\n        currentHaveStarNum: 0, //当前能用的星星数\n        skillsLevel: [0, 0, 0, 0, 0, 0]\n        // { //当前等级\n        //     arrow: 0,\n        //     barrack: 0, 兵营\n        //     magiclan: 0,\n        //     artillery: 0,\n        //     bomb: 0, //炸弹技能\n        //     dispatchTroops: 0,//出兵技能\n        // },\n    }\n    /**\n     * 用户数据\n     */\n    private userData = null;\n    private ls = cc.sys.localStorage;\n\n    /**\n     * 没有该用户会 初始化该用户出来\n     * @param username \n     */\n    constructor(username: string) {\n        this.userData = StorageManager.ins.getData(\"userData:\" + username);\n        if (this.userData === null) {\n            this.userData = this.initUserData;\n            this.userData.username = username;\n        }\n        else\n            this.userData = JSON.parse(this.userData);\n    }\n\n    getUsername(): string {\n        return this.userData.username;\n    }\n\n    /**\n     * 重置技能，归回星星\n     */\n    resetSkill() {\n        this.userData.skillsLevel.fill(0);\n        this.userData.currentHaveStarNum = this.getStarSum();\n    }\n\n    /**\n     * 拥有的星星数\n     */\n    getCurrentHaveStarNum(): number {\n        return this.userData.currentHaveStarNum;\n    }\n\n    /**\n     * 减去拥有的星星\n     * @param n 星星数\n     */\n    subHavedStar(n: number) {\n        this.userData.currentHaveStarNum -= n;\n    }\n\n    private addHavedStar(n: number) {\n        this.userData.currentHaveStarNum += n;\n    }\n\n    /**\n     * 当前玩家一共得到多少个星星\n     * @returns start sum \n     */\n    getStarSum(): number {\n        if (this.userData === null)\n            return;\n        let s: number = 0;\n        for (let i = 0; i < this.userData.levelsReview.length; i++)\n            s += this.userData.levelsReview[i];\n        return s;\n    }\n\n    /**\n     * 玩家闯过了多少关\n     * @returns rush levels sum \n     */\n    getRushLevelsSum(): number {\n        if (this.userData === null)\n            return;\n\n        return this.userData.levelsReview.length;\n    }\n\n    /**\n     * 每关得到的分数\n     * @returns rush levels sum \n     */\n    getLevelsReview(): number[] {\n        if (this.userData === null)\n            return;\n\n        return this.userData.levelsReview;\n    }\n\n    /**\n     * Sets level review\n     * @param levelN 第几关，0开始\n     * @param review 得到的星星数\n     */\n    setLevelReview(levelN: number, review: number) {\n        if (levelN > this.userData.rushLevelsSum)\n            this.userData.rushLevelsSum = levelN;\n        else {\n            if (this.userData.levelsReview[levelN] === undefined) {\n                this.userData.levelsReview[levelN] = review;\n                this.addHavedStar(review);\n            }\n            else if (this.userData.levelsReview[levelN] < review) {\n                let add: number = review - this.userData.levelsReview[levelN];\n                this.userData.levelsReview[levelN] = review;\n                this.addHavedStar(add);\n            }\n            this.preseverData();\n        }\n    }\n\n    /**\n     * 当前技能的等级,0开始\n     * @returns rush levels sum \n     */\n    getSkillsLevel(): number[] {\n        if (this.userData === null)\n            return;\n\n        return this.userData.skillsLevel;\n    }\n\n    preseverData() {\n        StorageManager.ins.storageData(\"userData:\" + this.userData.username, JSON.stringify(this.userData))\n        console.log(\"保存用户数据:\", this.userData);\n    }\n}\n\nexport class GameConfig {\n    private gameConfig = null;\n\n    constructor(gameConfig: any) {\n        this.gameConfig = gameConfig;\n        console.log(\"新建一个GameConfig对象，显示json对象:\\n\", this.gameConfig);\n\n    }\n\n    getRateOfSale(): number {\n        return this.gameConfig.rateOfSale;\n    }\n\n    getInitChip(): number {\n        return this.gameConfig.initChip;\n    }\n\n    getInitBlood(): number {\n        return this.gameConfig.initBlood;\n    }\n\n    getTowerUpNeedStar(): object {\n        return this.gameConfig.towerUpNeedStar;\n    }\n\n    getSkillsUpNeedStar(): number[][] {\n        return this.gameConfig.skillsUpNeedStar;\n    }\n\n    /**\n     * 得到 一共有多少关\n     * @returns levels sum \n     */\n    getLevelsSum(): number {\n        return this.gameConfig.levelsSum;\n    }\n\n    /**\n     * 得到 最多可得到多少星星\n     * @returns start sum \n     */\n    getStarSum(): number {\n        return this.gameConfig.levelsSum * 3;\n    }\n\n    /**\n     * 得到士兵数据\n     * @returns  \n     */\n    getSoldierData() {\n        return this.gameConfig.soldierData;\n    }\n\n    getMonsterData(): any[] {\n        return this.gameConfig.mosterData;\n    }\n\n    getDataOfArrowTower(): any[] {\n        return this.gameConfig.dataOfTower.arrowTower;\n    }\n    getDataOfArtillery(): any[] {\n        return this.gameConfig.dataOfTower.artillery;\n    }\n    getDataOfBarrack(): any[] {\n        return this.gameConfig.dataOfTower.barrack;\n    }\n    getDataOfMagiclan(): any[] {\n        return this.gameConfig.dataOfTower.magiclan;\n    }\n\n}\n\nexport default class GameDataStorage {\n    private static gameConfig: GameConfig = null;\n    private static users: User[] = [];\n    private static usernames: string[] = null;\n    private static currentUser: User = null;\n    private static ls = cc.sys.localStorage;\n\n    /**\n     * 游戏打开时必须执行一次\n     * @param gameConfig json对象\n     */\n    static init(gameConfig: any) {\n        this.gameConfig = new GameConfig(gameConfig);\n        this.usernames = this.getNamesOfAllUser();\n        for (let i = 0; i < this.usernames.length; i++)\n            this.users.push(new User(this.usernames[i]));\n    }\n\n    private static getNamesOfAllUser(): string[] {\n        let r = StorageManager.ins.getData(\"namesOfAllUser\");\n        if (r === null)\n            return [];\n        else\n            return JSON.parse(r);\n\n    }\n\n    /**\n     * 保存所有用户的名字\n     */\n    private static preserveNamesOfAllUser() {\n        if (this.usernames.length > 0) {\n            let json: string = JSON.stringify(this.usernames);\n            StorageManager.ins.storageData(\"namesOfAllUser\", json);\n            console.log(\"所有用户名保存成功!\");\n        }\n    }\n\n    static getGameConfig() {\n        return this.gameConfig;\n    }\n\n    /**\n     * 获得当前使用的用户\n     * @returns current user \n     */\n    static getCurrentUser(): User {\n        return this.currentUser;\n    }\n\n    static setCurrentUser(user: User) {\n        this.currentUser = user;\n    }\n\n    /**\n     * 得到所有用户的信息\n     * @returns users \n     */\n    static getUsers(): User[] {\n        return this.users;\n    }\n\n    /**\n     * 新建一个用户\n     * @param username \n     */\n    static createUser(username: string) {\n        let newUser: User = new User(username);\n        this.users.push(newUser);\n        this.usernames.push(username);\n        this.preserveNamesOfAllUser();\n        newUser.preseverData();\n    }\n\n    static delUser(username: string) {\n        //从所有用户名中移除\n        Utils.remvoeItemOfArray(this.usernames, username);\n        //从用户数组中移除\n        for (let i = 0; i < this.users.length; i++)\n            if (this.users[i].getUsername() === username) {\n                this.users.splice(i, 1);\n                break;\n            }\n        //从本地存储数据中删除\n        StorageManager.ins.removeData(\"userData:\" + username);\n        this.preserveNamesOfAllUser();\n    }\n\n    /**\n     * 保存游戏数据,游戏退出时必须执行\n     */\n    static preserveGameData() {\n        for (let v of this.users)\n            v.preseverData();\n        this.preserveNamesOfAllUser();\n    }\n}\n\n"]}