{"version":3,"sources":["assets/scripts/common/frameAnimation.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class FrameAnimation extends cc.Component {\n\n    @property({\n        displayName: \"播放速度\",\n        tooltip: \"多少秒播放一帧\"\n    })\n    private playSpeed: number = 0.1;\n\n    @property({\n        type: [cc.SpriteFrame],\n        tooltip: \"帧图片\"\n    })\n    private spriteFrames: cc.SpriteFrame[] = [];\n\n    @property({\n        type: cc.SpriteFrame,\n        tooltip: \"动画播放完后的禁止状态的图片，如果没有就会显示第一帧\"\n    })\n    private idle: cc.SpriteFrame = null;\n\n    @property({})\n    private playOnLoad: boolean = false;\n\n    private sprite: cc.Sprite = null;\n    private isPlay: boolean = false;\n    /**\n     * 帧动画接下来播放哪一帧\n     */\n    private nextIndex: number = 0;\n    /**\n     * 当前播放时间\n     */\n    private timeSum = 0;\n    private backFunc: Function = null;\n    /**\n     * 是否循环播放\n     */\n    private isLoop: boolean = false;\n    /**\n     * 是否倒序播放\n     */\n    private isInvertedPlay: boolean = false;\n    /**\n     * 动画播放结束后是否恢复为第一帧\n     */\n    private isFirstFrameInEnd: boolean = true;\n\n    onLoad() {\n        this.sprite = this.node.getComponent(cc.Sprite);\n    }\n\n    start() {\n        if (this.playOnLoad)\n            this.play(true);\n    }\n\n    /**\n     * 播放帧动画\n     * @param isLoop 是否循环播放\n     * @param isFirstFrameInEnd 动画播放结束后是否恢复为第一帧\n     * @param isInvertedPlay 是否倒序播放一次\n     * @param backFunc 动画播放完后将执行该函数\n     */\n    play(isLoop: boolean, isFirstFrameInEnd: boolean = true, isInvertedPlay: boolean = false, backFunc: Function = null) {\n        this.isLoop = isLoop;\n        this.backFunc = backFunc;\n        this.isFirstFrameInEnd = isFirstFrameInEnd;\n        this.nextIndex = 0;\n        this.timeSum = 0;\n        this.isInvertedPlay = isInvertedPlay;\n\n        if (this.isInvertedPlay) {\n            this.spriteFrames.reverse();\n        }\n\n        this.setSpriteFrame(this.spriteFrames[this.nextIndex++]);\n        this.isPlay = true;\n    }\n\n    /**\n     * 停止播放,恢复成等待图片，没有就恢复成第一帧\n     */\n    stop() {\n        this.isPlay = false;\n        if (this.idle === null)\n            this.sprite.spriteFrame = this.spriteFrames[0];\n        else\n            this.sprite.spriteFrame = this.idle;\n    }\n\n    pause() {\n        this.isPlay = false;\n    }\n\n    continue() {\n        this.isPlay = true;\n    }\n\n    /**\n     * 设置 动画播完后 显示的图片\n     * @param f \n     */\n    setIdle(f: cc.SpriteFrame) {\n        this.idle = f;\n    }\n\n    /**\n     * Sets sprite frame\n     * @param spriteFrame 图片\n     */\n    setSpriteFrame(spriteFrame: cc.SpriteFrame) {\n        this.sprite.spriteFrame = spriteFrame;\n    }\n\n    /**\n     * 设置帧数组\n     * @param frameArray 帧数组\n     */\n    setFrameArray(frameArray: cc.SpriteFrame[]) {\n        this.spriteFrames = [];\n        for (let i = 0; i < frameArray.length; i++) {\n            this.spriteFrames.push(frameArray[i]);\n        }\n    }\n\n    /**\n     * Gets sprite frame\n     * @returns sprite frame 图片\n     */\n    getSpriteFrame(): cc.SpriteFrame {\n        return this.sprite.spriteFrame;\n    }\n\n    /**\n     * 动画的播放时间\n     * @returns duration \n     */\n\n    getDuration(): number {\n        return this.playSpeed * this.spriteFrames.length;\n    }\n\n    update(dt) {\n        if (this.isPlay) {\n            this.timeSum += dt;\n            if (this.timeSum >= this.playSpeed) {\n                this.sprite.spriteFrame = this.spriteFrames[this.nextIndex++];\n                this.timeSum = 0;\n\n                if (this.nextIndex >= this.spriteFrames.length) { //一轮播放完毕\n                    if (this.isLoop) //要循环播放\n                        this.nextIndex = 0;\n                    else {\n                        this.isPlay = false;\n\n                        //播放完后的处理\n                        if (this.idle) //有不播放动画时的图片\n                            this.sprite.spriteFrame = this.idle;\n                        else if (this.isFirstFrameInEnd)\n                            this.sprite.spriteFrame = this.spriteFrames[0]; //复原为第一帧\n\n                        //重置\n                        if (this.isInvertedPlay) {\n                            this.spriteFrames.reverse();\n                            this.isInvertedPlay = false;\n                        }\n\n                        if (this.backFunc !== null)\n                            this.backFunc();\n                        return;\n                    }\n                }\n            }\n        }\n    }\n}\n"]}