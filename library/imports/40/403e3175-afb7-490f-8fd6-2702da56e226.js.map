{"version":3,"sources":["assets/scripts/levelScene/tower/arrow/arrowTower.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import FrameAnimation from \"../../../common/frameAnimation\";\nimport GameDataStorage, { GameConfig } from \"../../../common/module/gameDataManager\";\nimport Arrower from \"./arrower\";\n\nconst { ccclass, property } = cc._decorator;\n\n\n@ccclass\nexport default class ArrowTower extends cc.Component {\n\n    @property({\n        type: [cc.Vec2],\n        tooltip: \"各等级的人的Y坐标\"\n    })\n    private offsetY: cc.Vec2[] = [];\n\n    @property({\n        type: cc.Prefab\n    })\n    private arrowPrefab: cc.Prefab = null;\n\n    @property([cc.SpriteAtlas])\n    private atlas: cc.SpriteAtlas[] = [];\n\n    /* 塔的属性 */\n    /**\n     * 塔的等级\n     */\n    level: number = 1;\n    maxLevel: number = 4;\n    private attack: number;\n    /**\n     * 箭的速度\n     */\n    private speedOfArrow: number;\n    shootRange: number;\n    /**\n     * 射手射速\n     */\n    private speedOfShoot: number;\n    price: number;\n\n    private leftArrower: Arrower = null;\n    private rightArrower: Arrower = null;\n    /**\n     * 左右两个士兵的 帧动画组件\n     */\n    private towerBG: cc.Sprite = null;\n    private frameAnimations: FrameAnimation[] = [];\n    private gameConfig: GameConfig;\n\n    /* 控制 */\n    /**\n     * false为士兵朝下\n     */\n    private toward: boolean = false;\n\n    /* 数据 */\n    private wPos: cc.Vec2;\n    private dataOfTower: any[] = null;\n    private poolOfArrow: cc.NodePool = null;\n\n    onLoad() {\n        let l: cc.Node = this.node.getChildByName(\"leftPerson\");\n        let r: cc.Node = this.node.getChildByName(\"rightPerson\");\n        this.frameAnimations[0] = l.getComponent(\"frameAnimation\");\n        this.frameAnimations[1] = r.getComponent(\"frameAnimation\");\n        this.leftArrower = l.getComponent(\"arrower\")\n        this.rightArrower = r.getComponent(\"arrower\")\n        this.towerBG = this.node.getChildByName(\"bg\").getComponent(cc.Sprite);\n        this.gameConfig = GameDataStorage.getGameConfig();\n        this.dataOfTower = this.gameConfig.getDataOfArrowTower();\n\n\n        this.createPoolOfArrow();\n    }\n\n    start() {\n        this.wPos = this.node.parent.convertToWorldSpaceAR(this.node.getPosition());\n        this.init();\n    }\n\n    private init() {\n        this.attack = this.dataOfTower[this.level - 1].attack;\n        this.speedOfArrow = this.dataOfTower[this.level - 1].speedOfArrow;\n        this.shootRange = this.dataOfTower[this.level - 1].shootRange;\n        this.speedOfShoot = this.dataOfTower[this.level - 1].speedOfShoot;\n        this.price = this.dataOfTower[this.level - 1].price;\n\n        this.initArrower();\n    }\n\n    /* 箭对象池 */\n    private createPoolOfArrow() {\n        if (this.poolOfArrow !== null)\n            return;\n        this.poolOfArrow = new cc.NodePool();\n        for (let i = 0; i < 2; i++) {\n            this.poolOfArrow.put(cc.instantiate(this.arrowPrefab));\n        }\n    }\n    getArrowBullet(): cc.Node {\n        let r: cc.Node = null;\n        if (this.poolOfArrow.size() > 0)\n            r = this.poolOfArrow.get();\n        else\n            r = cc.instantiate(this.arrowPrefab);\n        r.opacity = 255;\n        return r;\n    }\n    releaseArrowBullt(n: cc.Node) {\n        this.poolOfArrow.put(n);\n    }\n    private clearPoolOfArrow() {\n        this.poolOfArrow.clear();\n    }\n\n    private initArrower() {\n        //设置位置和图片\n        this.frameAnimations[0].node.y = this.offsetY[this.level - 1].y;\n        this.frameAnimations[1].node.y = this.offsetY[this.level - 1].y;\n        let atlas: cc.SpriteAtlas = this.atlas[this.level - 1];\n        let spriteArr: cc.SpriteFrame[] = atlas.getSpriteFrames();\n\n        //设置塔的皮肤\n        this.towerBG.spriteFrame = spriteArr[0];\n        this.setSkin(this.frameAnimations[0], spriteArr);\n        this.setSkin(this.frameAnimations[1], spriteArr);\n\n        //传参\n        this.leftArrower.init(this.wPos, this.speedOfArrow, this.shootRange, this.speedOfShoot, this.attack);\n        this.rightArrower.init(this.wPos, this.speedOfArrow, this.shootRange, this.speedOfShoot, this.attack);\n    }\n\n\n    /**\n     * 设置士兵的皮肤和帧动画\n     * @param frameAnimation \n     * @param res 图片资源\n     */\n    private setSkin(frameAnimation: FrameAnimation, res: cc.SpriteFrame[]) {\n        //设置士兵等待时的皮肤\n        let i: number = 5; //朝下\n        if (this.toward)\n            i = 6\n        frameAnimation.setSpriteFrame(res[i]);\n        frameAnimation.setIdle(res[i]);\n\n        //设置帧动画\n        let arr: cc.SpriteFrame[] = [];\n        i = 1;\n        if (this.toward) //朝下\n            i = 7;\n        for (let j = 0; j < 4; j++)\n            arr.push(res[i + j]);\n        frameAnimation.setFrameArray(arr);\n    }\n\n    destroySelf() {\n        this.clearPoolOfArrow();\n        this.node.destroy();\n    }\n\n    /**\n     * 升级\n     */\n    upgrade() {\n        if (this.level === 4)\n            return;\n        this.level++;\n        this.init();\n    }\n\n    getPriceOfUpgrade(): number {\n        return this.dataOfTower[this.level].price;\n    }\n\n    getDataOfTower(): any[] {\n        return this.dataOfTower;\n    }\n\n    update(dt) {\n\n    }\n}\n"]}