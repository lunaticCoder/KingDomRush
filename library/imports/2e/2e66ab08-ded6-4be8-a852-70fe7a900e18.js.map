{"version":3,"sources":["assets/scripts/levelScene/tower/arrow/arrowBullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Monster from \"../../monster/monster\";\nimport ArrowTower from \"./arrowTower\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class ArrowBullet extends cc.Component {\n\n    /* 资源 */\n    @property({\n        type: cc.SpriteFrame,\n        tooltip: \"半截箭图片\"\n    })\n    private decalArrow: cc.SpriteFrame = null;\n\n    @property({\n        type: cc.SpriteFrame,\n        tooltip: \"完整的箭图片\"\n    })\n    private completedArrow: cc.SpriteFrame = null;\n\n    /* 组件 */\n    private sprite: cc.Sprite = null;\n    private arrowTower: ArrowTower = null;\n\n    /* 属性 */\n    private attack: number = null;\n\n    /* 记录 */\n    private lastPos: cc.Vec2 = null;\n    private curPos: cc.Vec2 = null;\n    /**\n     * 修正箭的初始方向为正右\n     */\n    private readonly offsetDegree: number = 180;\n\n    /* 控制 */\n    private isUpdateDir: boolean = true;\n    /**\n     * 是否落地\n     */\n    private isFallFloor: boolean = false;\n\n    onLoad() {\n        this.sprite = this.node.getComponent(cc.Sprite);\n        this.arrowTower = this.node.parent.parent.getComponent(\"arrowTower\");\n    }\n\n    start() {\n    }\n\n    /**\n     * 初始化\n     * @param attack \n     * @param dir 箭的朝向，true为左\n     */\n    init(attack: number, speed: number, dir: boolean) {\n        this.attack = attack;\n        if (dir)\n            this.node.rotation = 50;\n        else\n            this.node.rotation = -230;\n\n        //显示\n        this.sprite.spriteFrame = this.completedArrow;\n\n        //记录\n        this.lastPos = null;\n        this.curPos = this.node.getPosition();\n\n        //控制\n        this.isUpdateDir = true;\n        this.isFallFloor = false;\n\n        this.scheduleOnce(this.updateDir, 0.07);\n    }\n\n    /**\n     * 移动，世界坐标\n     * @param start 起点\n     * @param end 终点\n     * @param time 从起点到终点的时间\n     */\n    moveTo(start: cc.Vec2, end: cc.Vec2, time: number) {\n        let nodeStart: cc.Vec2 = this.node.parent.convertToNodeSpaceAR(start);\n        let nodeEnd: cc.Vec2 = this.node.parent.convertToNodeSpaceAR(end);\n        let sub: cc.Vec2 = nodeEnd.sub(nodeStart);\n        let middle: cc.Vec2 = nodeStart.add(cc.v2(sub.x / 2, sub.y / 2));\n        let c: cc.Vec2 = cc.v2(middle.x, nodeEnd.y + 60);\n        if (start.x === end.x)\n            c.x += 30;\n\n        this.node.setPosition(nodeStart);\n        let move: cc.ActionInterval = cc.bezierTo(time, [nodeStart, c, nodeEnd]);\n\n        let func1: cc.ActionInstant = cc.callFunc(function () {\n            this.isUpdateDir = false;\n            this.isFallFloor = true;\n            this.sprite.spriteFrame = this.decalArrow;\n        }, this);\n\n        let fade: cc.ActionInterval = cc.fadeOut(2);\n\n        let func2: cc.ActionInstant = cc.callFunc(function () {\n            this.destroySelf();\n        }, this);\n\n        let seq: cc.ActionInterval = cc.sequence(move, func1, fade, func2);\n        this.node.runAction(seq);\n    }\n\n    onCollisionEnter(other: cc.Collider, self: cc.Collider) {\n        if (this.isFallFloor)\n            return;\n\n        let node: cc.Node = other.node;\n        let group: string = node.group;\n\n        if (group === \"Enemy\") {\n            this.node.stopAllActions();\n            let m: Monster = node.getComponent(\"monster\");\n            m.injure(this.attack);\n\n            this.destroySelf();\n        }\n    }\n\n    /**\n     * 更新方向\n     */\n    private updateDir() {\n        this.lastPos = this.curPos;\n        this.curPos = this.node.getPosition();\n        let dir: cc.Vec2 = this.curPos.sub(this.lastPos);\n        let degree: number = this.getDegree(dir);\n        if (degree === null)\n            return;\n        this.node.rotation = -(this.offsetDegree + degree);\n\n        if (this.isUpdateDir)\n            this.scheduleOnce(this.updateDir.bind(this), 0.07);\n    }\n\n    /**\n     * Gets degree\n     * @param dir 方向向量\n     * @returns degree [0,360),null为没有角度变化\n     */\n    private getDegree(dir: cc.Vec2): number {\n        let rot: number;\n        if (dir.x === 0 && dir.y === 0)\n            return null;\n        if (dir.x === 0 && dir.y > 0) //y上半轴\n            return 90;\n        else if (dir.x === 0 && dir.y < 0) //y下半轴\n            return 270;\n        else { //不在y轴上\n            let r: number = Math.atan(dir.y / dir.x);\n            let d: number = r * 180 / Math.PI;\n            rot = d;\n        }\n\n        if (rot === 0) //在x轴上\n            if (dir.x > 0)\n                rot = 0;\n            else\n                rot = 180;\n        else if (dir.x < 0 && dir.y > 0 || dir.x < 0 && dir.y < 0) //在第二三象限\n            rot += 180;\n        else if (dir.x > 0 && dir.y < 0) //在第四象限\n            rot += 360;\n        return rot;\n    }\n\n    private destroySelf() {\n        this.arrowTower.releaseArrowBullt(this.node);\n    }\n\n}\n"]}