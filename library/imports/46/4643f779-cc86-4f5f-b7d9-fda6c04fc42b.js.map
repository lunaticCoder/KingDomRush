{"version":3,"sources":["assets/scripts/levelScene/tower/artillery/artilleryBullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import FrameAnimation from \"../../../common/frameAnimation\";\nimport Monster from \"../../monster/monster\";\nimport Artillery from \"./artilleryTower\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class ArtilleryBullet extends cc.Component {\n\n    private level: number = null;\n    private attack: number = 0;\n    private harmRadian: number;\n    private frameAnim: FrameAnimation = null;\n    private artilleryTower: Artillery = null;\n\n    onLoad() {\n        this.frameAnim = this.node.getComponent(\"frameAnimation\");\n        this.artilleryTower = this.node.parent.getComponent(\"artilleryTower\");\n    }\n\n    start() {\n\n    }\n\n    /**\n     * 设置炮的攻击力和速度\n     * @param attack \n     * @param bombRange 炸弹爆炸范围\n     */\n    init(l: number, attack: number, bombRange: number) {\n        this.level = l;\n        this.attack = attack;\n        this.harmRadian = bombRange;\n    }\n\n    /**\n     * 移动，世界坐标\n     * @param start 起点\n     * @param end 终点\n     * @param time 移动时间\n     * \n     */\n    moveTo(start: cc.Vec2, end: cc.Vec2, time: number) {\n        let nodeStart: cc.Vec2 = this.node.parent.convertToNodeSpaceAR(start);\n        let nodeEnd: cc.Vec2 = this.node.parent.convertToNodeSpaceAR(end);\n        let sub: cc.Vec2 = nodeEnd.sub(nodeStart);\n        let middle: cc.Vec2 = cc.v2(nodeStart.x + sub.x / 2, nodeStart.y + sub.y / 2);\n        let c: cc.Vec2 = cc.v2(middle.x, nodeEnd.y + 60);\n        if (start.x === end.x)\n            c.x += 30;\n\n        this.node.setPosition(nodeStart);\n        let move: cc.ActionInterval = cc.bezierTo(time, [nodeStart, c, nodeEnd]);\n\n        let func: cc.ActionInstant = cc.callFunc(function () {\n            this.frameAnim.play(false, true, false, function () {\n                this.causeHarm(end);\n                this.destroySelf();\n            }.bind(this));\n        }, this);\n\n        let seq: cc.ActionInterval = cc.sequence(move, func);\n        this.node.runAction(seq);\n    }\n\n    /**\n     * Causes harm\n     * @param pos 爆炸点 世界坐标\n     */\n    private causeHarm(pos: cc.Vec2) {\n        for (let i = 0; i < Monster.monstersOfAlive.length; i++) {\n            let mScr: Monster = Monster.monstersOfAlive[i];\n            if (this.isInjuredInScope(pos, mScr.getWPos()))\n                mScr.injure(this.attack);\n        }\n    }\n    /**\n     * @param pos 爆炸点 世界 \n     */\n    private isInjuredInScope(pos: cc.Vec2, mwp: cc.Vec2): boolean {\n        let l: number = mwp.sub(pos).mag();\n        if (l <= this.harmRadian)\n            return true;\n        return false;\n    }\n\n    private destroySelf() {\n        this.artilleryTower.releaseBullt(this.level, this.node);\n    }\n\n    // update (dt) {}\n}\n"]}